---
driver:
  name: vagrant
  driver_config:
    ssl_verify_mode: ":verify_none"
    customize:
      cpus: 4
      memory: 8192
      accelerate3d: "off"
      accelerate2dvideo: "off"
      audio: "none"
      usbcardreader: "off"
      vrde: "off"
      usb: "off"
      nictype1: "82540EM"
      clipboard: "disabled"

platforms:
  - name: amazon2
    driver:
      box: generic/centos7

verifier:
  input_files:
    - ec2.inputs.yml
  reporter:
    - cli
    - json:spec/results/vagrant_%{platform}_%{suite}.json

lifecycle:
  post_create:
    - remote: |
        sudo yum -y install git python3-pip
        sudo python3 -m pip install --user --upgrade pip
  pre_converge:
    - remote: |
        echo 'updating the ec2-user password'
        sudo chpasswd <<<"ec2-user:<%= ENV['SUDO_PASSWD'] || 'P@ssw0rd!' %>"
        echo "NOTICE - Updating the vagrant user to keep sudo working"
        sudo chage -d $(( $( date +%s ) / 86400 )) vagrant
        echo "NOTICE - Updating root passwd"
        echo 'password' | sudo passwd --stdin root
        echo "NOTICE - updating vagrant sudo config"
        sudo chmod 600 /etc/sudoers && sudo sed -i'' "/vagrant/d" /etc/sudoers && sudo chmod 400 /etc/sudoers
